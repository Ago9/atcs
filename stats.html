<!DOCTYPE html>
<meta charset="utf-8">

<head>
	<h1>duration (in minutes) of visit for a visitor:</h1>
</head>

<div id="my_dataviz"></div>

<body>
	
<script src="http://d3js.org/d3.v5.min.js"></script>
<script src="https://d3js.org/d3-fetch.v1.min.js"></script>

<script>
// set the dimension and margins of the graph
var margin = {top: 30, right: 30, bottom: 70, left: 60},
	width = 460 - margin.left - margin.right,
	height = 600 - margin.top - margin.bottom;

// append the svg object to the body of the page

var svg = d3.select("#my_dataviz")
	.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	.append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top +")");

var visitor = [
	{"id":"1", "group":"1","group_size":"2","data":"17/03/11","start_time":"12:26", "end_time": "13:15"},
	{"id":"2", "group":"1","group_size":"2","data":"17/03/11","start_time":"12:26", "end_time": "13:15"},
	{"id":"3", "group":"2","group_size":"1","data":"17/03/11","start_time":"13:45", "end_time": "14:40"},
	{"id":"4", "group":"3","group_size":"1","data":"17/03/11","start_time":"14:20", "end_time": "15:14"},
	{"id":"5", "group":"4","group_size":"2","data":"17/03/11","start_time":"14:45", "end_time": "15:20"},
	{"id":"6", "group":"4","group_size":"2","data":"17/03/11","start_time":"14:45", "end_time": "15:20"},
	{"id":"7", "group":"5","group_size":"1","data":"17/03/11","start_time":"12:26", "end_time": "13:53"},
	{"id":"8", "group":"6","group_size":"1","data":"18/03/11","start_time":"12:00", "end_time": "13:53"},
	{"id":"9", "group":"6","group_size":"1","data":"18/03/11","start_time":"12:00", "end_time": "13:53"},
	{"id":"10", "group":"7","group_size":"1","data":"18/03/11","start_time":"14:05", "end_time": "14:58"},
	];

var visitDuration = visitor.map(function(d){
	return {
		group: d.group,
		durata: durata(d.start_time,d.end_time)
	};
});

function durata(i,f){
	inizio = i.split(":");
	fine = f.split(":");
	ora = (fine[0]-inizio[0]);
	min = (fine[1]-inizio[1]);

	if (min < 0){
		min += 60;
		min += (ora-1)*60;
	} else {
		min += 60*ora;
	}

	return min

}

// x axis
var x = d3.scaleLinear()
	.domain([0, 120])
	.range([0, width]);

svg.append("g")
	.attr("transform", "translate(0," + height + ")")
  	.call(d3.axisBottom(x))
  	.selectAll("text")
    	.attr("transform", "translate(-10,0)rotate(-45)")
    	.style("text-anchor", "end");

// y axis

var y = d3.scaleBand()
	.range([0, height ])
	.domain(visitor.map(function(d) { return d.group; })) // variabile da vedere sull'asse
	.padding(.1);

svg.append("g")
	.call(d3.axisLeft(y));

svg.selectAll("myRect")
	.data(visitDuration) // selezione dei dati da mostrare
	.enter()
	.append("rect")
	.attr("x", x(0))
	.attr("y", function(d){ return y(d.group); }) // valori y
	.attr("width", function(d) { return x(d.durata); }) // dimensioni delle barre
	.attr("height", y.bandwidth() )
    .attr("fill", "#0000ff")



</script>

</body>
